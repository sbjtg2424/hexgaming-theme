
{%- assign section_background_color = '#ffffff' -%}
{%- assign text_color = '#3d4246' -%}
{%- assign model_size = 40 -%}
{%- assign model_offset_top = 0 -%}

{%- assign option_background_color = '#ffffff' -%}
{%- assign option_text_color = '#3d4246' -%}
{%- assign option_border_color = 'lightgray' -%}
{%- assign option_selected_border_color = '#0098CF' -%}


{% if product_handle %}
  {% assign product = all_products[product_handle] %}
{% endif %}

{% if product %}
  {% assign product_handle = product.handle %}
  {% assign models = product.media | where: "media_type", "model" %}

  {% if models %}
    {% if model_id %}
      {% assign model = models | where: "id", model_id | first %}
    {% else %}
      {% assign model = models | first %}
    {% endif %}
  {% endif %}

{% endif %}


{% if model %}

  <script type="module" src="https://cdn.jsdelivr.net/gh/angle3d/tda-mv/tda-model-viewer-1.7.2.min.js"></script>

  {% assign model_source_glb = model.sources | where: "format", "glb" | first %}
  {% assign model_source_usdz = model.sources | where: "format", "usdz" | first %}

  <div class="tda-customizer-wrapper-{{model.id}} tda-customizer-wrapper" type="snippet">
    <div id="no-customization-created-warning-{{model.id}}" class="no-customization-created-warning">
       <h4>No customization has been created for this 3D model</h4>
       <p style="color: white">You can create a customization now by clicking <a href="https://app.angle3d.co/customizer/products/{{product.id}}/models/{{model.id}}" target="_blank" style="color: white; text-decoration: underline">here</a></p>
       <p style="color: white">(Don't worry! Your customers will not see this error message.)</p>
    </div>

    <div id="tda-customizer-app-section-container-{{model.id}}" handle="{{product_handle}}" class="tda-customizer-app-section-container" style="background: {{section_background_color}}; color: {{text_color}}; padding: 15px;">

    <div id="tda-customizer-app-section-loading-{{model.id}}" class="tda-customizer-app-section-loading">
      <img src="https://cdn.fivelive.co/angle3d/img/logo-dark-gray.png"/>
      <div>LOADING 3D CONFIGURATOR</div>
    </div>

    <div id="tda-customizer-app-section-wrapper-{{model.id}}" class="tda-customizer-app-section-wrapper">
        <div style="text-align: center">
            <h1>3D Configurator</h1>
        </div>

        <div id="tda-app-section-content-{{model.id}}" class="tda-app-section-content">
          <div id="tda-app-section-model-viewer-container-{{model.id}}" class="tda-app-section-model-viewer-container" style="flex-grow: 1">
            <div id="tda-app-section-model-viewer-sticky-container-{{model.id}}" class="tda-app-section-model-viewer-sticky-container" offsettop="{{model_offset_top}}" style="background: {{section_background_color}}">
              <tda-model-viewer id="tda-app-section-model-viewer-{{model.id}}" class="tda-app-section-model-viewer"
                            src="{{model_source_glb.url}}"

                            poster="{{model.preview_image.src  | img_url: "master"}}"
                            reveal="interaction"
                            shadow-intensity="1" camera-controls
                            quick-look-browsers="">

                            </tda-model-viewer>
              <div id="model-loading-{{model.id}}">
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
              </div>
            </div>
          </div>

          <div id="tda-customizer-controls-container-{{model.id}}" class="tda-customizer-controls-container" style="background: unset; color: {{text_color}};">
            <h2>Customize</h2>

            <div id="tda-customizer-customization-options-container-{{model.id}}" class="tda-customizer-customization-options-container">

              <!--CONTENT GENERATED BY SCRIPTTAG-->

            </div>

            <div id="customization-options-loading-{{model.id}}" class="customization-options-loading lds-ring"><div></div><div></div><div></div><div></div></div>
          </div>
        </div>

        <div id="tda-customizer-footer-{{model.id}}" class="tda-customizer-footer" style="z-index: 1; position: relative">
          <div class="tda-customizer-footer-left">
            <div id="tda-customizer-product-title-{{model.id}}" class="tda-customizer-product-title"></div>
            <div id="tda-customizer-variant-name-{{model.id}}" class="tda-customizer-variant-name"></div>
            <div class="tda-customizer-variant-price-container">
              <div><strong id="tda-customizer-variant-price-{{model.id}}" class="tda-customizer-variant-price"></strong></div>
              <div id="tda-customizer-variant-compare-at-price-container-{{model.id}}" class="tda-customizer-variant-compare-at-price-container">
                <strong id="tda-customizer-variant-compare-at-price-{{model.id}}" class="tda-customizer-variant-compare-at-price"></strong>
                <div class="tda-customizer-variant-price-sale">SALE</div>
              </div>
            </div>
          </div>

          <div class="tda-customizer-footer-right">
            <div class="tda-customizer-footer-qty tda-customizer-footer-qty-{{model.id}}">
              <span style="margin-right: 10px">
                Quantity
              </span>
              <div class="qty-input-group qty-input-group-{{model.id}}">
                <input type="button" value="-" class="button-minus" data-field="quantity">
                <input type="number" step="1" min="1" max="100" value="1" name="quantity" class="quantity-field">
                <input type="button" value="+" class="button-plus" data-field="quantity">
              </div>
            </div>

            <div class="tda-customizer-footer-btns">
              <button id="tda-customizer-footer-atc-btn-{{model.id}}" class="tda-customizer-footer-atc-btn">Add to cart</button>
              <button id="tda-customizer-footer-buy-btn-{{model.id}}" class="tda-customizer-footer-buy-btn">Buy now</button>
            </div>
          </div>
        </div>
      </div>


    </div>

    <style>
        .tda-customizer-app-section-container *:focus {
          outline: none;
        }

        .tda-customizer-app-section-container {
          position: relative;
        }

        .tda-customizer-app-section-wrapper {
          opacity: 0;
        }

        .tda-customizer-app-section-loading {
          text-align: center;
          position: absolute;
          width: 100%;
          top: 50%;
          font-weight: 600;
          margin-left: -15px;
          animation: blink 1s linear infinite;
        }

        .tda-customizer-app-section-loading img {
          width: 70px;
          height: 70px;
        }

        @keyframes blink{
          0%{opacity: 0.2;}
          50%{opacity: .5;}
          100%{opacity: 1;}
        }

        .tda-app-section-content{
            display: flex;
            flex-direction: column;
        }

        #tda-app-section-model-viewer-container-{{model.id}} {
          width: 90vw;
          height: 90vw;
          margin: auto;
        }

        .tda-app-section-model-viewer-sticky-container {
          overflow-y: hidden;
        }

        #tda-app-section-model-viewer-{{model.id}} {
            margin: auto;
            outline: none;
            width: 90vw;
            height: 90vw;
            --poster-color: transparent;
        }

        .fixed-model-{{model.id}} {
            position: fixed;
            top: {{model_offset_top}}px;
            border-bottom: 1px solid lightgray;
        }

        .tda-customizer-customization-option-value {
          background: white;
          color: #656565;
        }

        .tda-customizer-customization-option-value-{{model.id}} {
          color: {{option_text_color}};
          border: 1px solid {{option_border_color}};
          background: {{option_background_color}};
        }

        .tda-customizer-customization-option-value-{{model.id}}:hover {
          border: 1px solid {{option_selected_border_color}};
        }

        .tda-customizer-customization-option-value-selected-{{model.id}} {
          border-color: {{option_selected_border_color}};
        }

        .tda-customizer-customization-option-title-{{model.id}} {
         color: {{text_color}};
        }

        .tda-customizer-customization-option-description-{{model.id}} {
         color: {{text_color}};
        }

        .no-customization-created-warning {
          background: #a20000;
          padding: 20px;
          color: white;
          display: none;
          text-align: center;
        }

        #model-loading-{{model.id}} {
          opacity: 0;
          color: black;
          font-size: 1.5em;
          text-align: center;
          position: relative;
          top: -90px;
          margin: auto;
          width: 200px;
          border-radius: 3px;
        }

        .model-loading-visible {
          opacity: 1 !important;
        }

        #customization-options-loading-{{model.id}} {
          color: {{text_color}};
        }

        @media only screen and (min-width: 1150px), only screen and (orientation: landscape) {
            .tda-app-section-content{
                flex-direction: row;
            }

          #tda-app-section-model-viewer-container-{{model.id}} {
              width: {{model_size}}vw;
              height: {{model_size}}vw;
              margin-left: initial;
            }

          #tda-app-section-model-viewer-{{model.id}} {
              width: {{model_size}}vw;
              height: {{model_size}}vw;
          }

          .fixed-model-{{model.id}} {
              background-color: initial;
              position: initial;
              top: initial;
              border-bottom: none;
          }

          #tda-customizer-controls-container-{{model.id}} {
            height: {{model_size}}vw;
          }

          .tda-customizer-app-section-loading {
            font-size: 1.3em;
          }
        }

    </style>
  </div>
{% endif %}


